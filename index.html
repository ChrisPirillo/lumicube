<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Document Metadata -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumicube: Interactive WebGL Fractal Art</title>
    
    <!-- SEO Meta Tags -->
    <meta name="author" content="Chris Pirillo">
    <meta name="description" content="Explore Lumicube, an interactive 3D fractal art generator. Manipulate mesmerizing WebGL visuals in real-time and create your own unique digital sculptures.">
    <meta name="keywords" content="lumicube, webgl, fractal art, interactive art, 3d graphics, generative art, real-time rendering, digital art, creative coding">
    <link rel="canonical" href="https://pirillo.com/arcade/lumicube.html">

    <!-- Open Graph / Facebook Meta Tags -->
    <meta property="og:title" content="Lumicube: Interactive WebGL Fractal Art">
    <meta property="og:description" content="Explore Lumicube, an interactive 3D fractal art generator. Manipulate mesmerizing WebGL visuals in real-time and create your own unique digital sculptures.">
    <meta property="og:url" content="https://pirillo.com/arcade/lumicube.html">
    <meta property="og:site_name" content="Chris Pirillo's Arcade">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://pirillo.com/arcade/images/lumicube.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@ChrisPirillo">
    <meta name="twitter:creator" content="@ChrisPirillo">
    <meta name="twitter:title" content="Lumicube: Interactive WebGL Fractal Art">
    <meta name="twitter:description" content="Explore Lumicube, an interactive 3D fractal art generator. Manipulate mesmerizing WebGL visuals in real-time and create your own unique digital sculptures.">
    <meta name="twitter:image" content="https://pirillo.com/arcade/images/lumicube.png">

    <!-- Performance: Resource Hints for faster loading -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.googletagmanager.com">
    
    <!-- Performance: Preload critical resources -->
    <link rel="preload" href="https://cdn.tailwindcss.com" as="script">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;500;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;500;700&display=swap"></noscript>

    <!-- Core Stylesheet (Tailwind) - This is render-blocking but necessary for initial UI styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Inlined Critical CSS for Initial Page Layout -->
    <style>
        /* Base styles to prevent layout shifts and ensure core structure is ready */
        body {
            font-family: 'Exo 2', sans-serif;
            margin: 0;
            overflow: hidden;
            background-color: #111827; /* bg-gray-900 */
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE 10+ */
            user-select: none; /* Standard syntax */
        }
        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }
        /* Custom scrollbar for settings panel */
        #settings-panel::-webkit-scrollbar {
            width: 8px;
        }
        #settings-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        #settings-panel::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }
        #settings-panel::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        /* Custom styles for range inputs */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            outline: none;
            transition: background 0.3s;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #3b82f6; /* bg-blue-500 */
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #ffffff;
        }
        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #ffffff;
        }
        #menu-toggle.menu-open-pos {
            right: 24.5rem; /* max-w-sm (24rem) + 0.5rem spacing */
        }
        @media (max-width: 384px) {
            #menu-toggle.menu-open-pos {
                 right: calc(100% - 3rem);
            }
        }
        /* Custom Toggle Switch */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #3b82f6;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #3b82f6;
        }
    </style>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1CQ4D3VQ3L"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-1CQ4D3VQ3L');
    </script>

    <!-- JSON-LD Structured Data for Rich Snippets -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Lumicube",
      "description": "An interactive 3D fractal art generator using WebGL, allowing real-time manipulation of mesmerizing visuals.",
      "url": "https://pirillo.com/arcade/lumicube.html",
      "applicationCategory": "MultimediaApplication",
      "operatingSystem": "Web-based",
      "author": {
        "@type": "Person",
        "name": "Chris Pirillo",
        "url": "https://chris.pirillo.com/"
      },
      "image": "https://pirillo.com/arcade/images/lumicube.png",
      "offers": {
        "@type": "Offer",
        "price": "0"
      }
    }
    </script>
</head>
<body>
    <!-- SEO: Using <main> for the primary content of the page -->
    <main>
        <!-- Canvas for WebGL rendering. Explicitly sized via JS to prevent CLS. -->
        <canvas id="gl-canvas" width="1920" height="1080" aria-label="Interactive WebGL fractal animation"></canvas>

        <!-- UI Control: Hamburger Menu Button -->
        <button id="menu-toggle" class="fixed top-4 right-4 z-50 p-2 rounded-md text-white bg-black bg-opacity-20 hover:bg-opacity-40 transition-all duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Toggle settings menu" aria-controls="settings-panel" aria-expanded="false">
            <svg id="menu-icon-open" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
            <svg id="menu-icon-close" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
    </main>

    <!-- SEO: Using <aside> for the settings panel, as it's complementary content -->
    <aside id="settings-panel" class="fixed top-0 right-0 h-full w-full max-w-sm bg-gray-900 bg-opacity-80 backdrop-blur-md text-white p-6 transform translate-x-full transition-transform duration-300 ease-in-out shadow-2xl flex flex-col">
        <h2 class="text-2xl font-bold mb-6 border-b border-gray-600 pb-3">Lumicube Settings</h2>
        <div class="flex-grow overflow-y-auto pr-2 grid grid-cols-[auto_1fr_auto] gap-x-4 gap-y-4 items-center">
            <label for="camera-dist" class="text-sm font-medium text-gray-300 justify-self-start">Camera Distance</label>
            <input id="camera-dist" type="range" min="1" max="20" step="0.1" class="w-full" aria-describedby="camera-dist-value">
            <span id="camera-dist-value" class="text-sm font-mono bg-gray-700 px-2 py-1 rounded-md w-16 text-center"></span>
            
            <label for="iterations" class="text-sm font-medium text-gray-300 justify-self-start">Iterations</label>
            <input id="iterations" type="range" min="10" max="150" step="1" class="w-full" aria-describedby="iterations-value">
            <span id="iterations-value" class="text-sm font-mono bg-gray-700 px-2 py-1 rounded-md w-16 text-center"></span>

            <label for="time-speed" class="text-sm font-medium text-gray-300 justify-self-start">Time Speed</label>
            <input id="time-speed" type="range" min="0" max="2" step="0.01" class="w-full" aria-describedby="time-speed-value">
            <span id="time-speed-value" class="text-sm font-mono bg-gray-700 px-2 py-1 rounded-md w-16 text-center"></span>

            <label for="exposure" class="text-sm font-medium text-gray-300 justify-self-start">Exposure</label>
            <input id="exposure" type="range" min="50" max="1000" step="1" class="w-full" aria-describedby="exposure-value">
            <span id="exposure-value" class="text-sm font-mono bg-gray-700 px-2 py-1 rounded-md w-16 text-center"></span>

            <label for="de-factor1" class="text-sm font-medium text-gray-300 justify-self-start">DE Factor 1</label>
            <input id="de-factor1" type="range" min="0.01" max="0.45" step="0.01" class="w-full" aria-describedby="de-factor1-value">
            <span id="de-factor1-value" class="text-sm font-mono bg-gray-700 px-2 py-1 rounded-md w-16 text-center"></span>

            <label for="de-factor2" class="text-sm font-medium text-gray-300 justify-self-start">DE Factor 2</label>
            <input id="de-factor2" type="range" min="0" max="5" step="0.01" class="w-full" aria-describedby="de-factor2-value">
            <span id="de-factor2-value" class="text-sm font-mono bg-gray-700 px-2 py-1 rounded-md w-16 text-center"></span>

            <label for="de-factor3" class="text-sm font-medium text-gray-300 justify-self-start">DE Factor 3</label>
            <input id="de-factor3" type="range" min="0.01" max="0.140" step="0.001" class="w-full" aria-describedby="de-factor3-value">
            <span id="de-factor3-value" class="text-sm font-mono bg-gray-700 px-2 py-1 rounded-md w-16 text-center"></span>

            <label for="sin-freq" class="text-sm font-medium text-gray-300 justify-self-start">Sin Frequency</label>
            <input id="sin-freq" type="range" min="0" max="20" step="0.1" class="w-full" aria-describedby="sin-freq-value">
            <span id="sin-freq-value" class="text-sm font-mono bg-gray-700 px-2 py-1 rounded-md w-16 text-center"></span>

            <label for="cam-rot-y" class="text-sm font-medium text-gray-300 justify-self-start">Camera Y Rot</label>
            <input id="cam-rot-y" type="range" min="-5" max="5" step="0.1" class="w-full" aria-describedby="cam-rot-y-value">
            <span id="cam-rot-y-value" class="text-sm font-mono bg-gray-700 px-2 py-1 rounded-md w-16 text-center"></span>

            <label for="cam-rot-z" class="text-sm font-medium text-gray-300 justify-self-start">Camera Z Rot</label>
            <input id="cam-rot-z" type="range" min="-5" max="5" step="0.1" class="w-full" aria-describedby="cam-rot-z-value">
            <span id="cam-rot-z-value" class="text-sm font-mono bg-gray-700 px-2 py-1 rounded-md w-16 text-center"></span>
            
            <label for="shape-morph" class="text-sm font-medium text-gray-300 justify-self-start">Shape Morph</label>
            <input id="shape-morph" type="range" min="0.0" max="1.0" step="0.01" class="w-full" aria-describedby="shape-morph-value">
            <span id="shape-morph-value" class="text-sm font-mono bg-gray-700 px-2 py-1 rounded-md w-16 text-center"></span>
            
            <label for="tiling-toggle" class="text-sm font-medium text-gray-300 justify-self-start">Enable Tiling</label>
            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in col-span-2 justify-self-start">
                <input type="checkbox" name="tiling-toggle" id="tiling-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                <label for="tiling-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
            </div>
            
            <label id="tiling-label" for="tiling" class="text-sm font-medium text-gray-300 justify-self-start">Tiling Density</label>
            <input id="tiling" type="range" min="2.0" max="20.0" step="0.1" class="w-full" aria-describedby="tiling-value">
            <span id="tiling-value" class="text-sm font-mono bg-gray-700 px-2 py-1 rounded-md w-16 text-center"></span>
        </div>
        <div class="mt-6 pt-6 border-t border-gray-600">
            <button id="reset-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                Reset to Defaults
            </button>
        </div>
    </aside>

    <!-- NOTE: Shader scripts are not executable JS and are loaded as text content. No 'async' or 'defer' is needed. -->
    <!-- Vertex Shader -->
    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec2 a_position;
        void main() {
            gl_Position = vec4(a_position, 0.0, 1.0);
        }
    </script>

    <!-- Fragment Shader -->
    <script id="fragment-shader" type="x-shader/x-fragment">
        precision highp float;
        
        uniform vec2 u_resolution;
        uniform float u_time;
        
        uniform float u_camera_dist;
        uniform float u_iterations;
        uniform float u_time_mult;
        uniform float u_exposure;
        uniform float u_d_factor1;
        uniform float u_d_factor2;
        uniform float u_d_factor3;
        uniform float u_sin_freq;
        uniform float u_cam_rot_y;
        uniform float u_cam_rot_z;
        uniform float u_shape_morph;
        uniform float u_tiling;
        uniform float u_is_tiling_enabled;

        void main() {
            vec4 o = vec4(0.0);
            float t = u_time * u_time_mult;

            vec3 rayOrigin = vec3(0.0, 0.0, u_camera_dist);
            vec2 uv = (gl_FragCoord.xy * 2.0 - u_resolution.xy) / u_resolution.y;
            vec3 rayDir = normalize(vec3(uv, -1.0));

            vec3 p,v;
            float z = 0.0, d = 0.0; 

            const int MAX_ITERATIONS = 150;
            for(int i = 0; i < MAX_ITERATIONS; i++) {
                if (float(i) >= u_iterations) {
                    break;
                }
                
                p = rayOrigin + z * rayDir;
                
                v = normalize(cos(t + vec3(0.0, u_cam_rot_y, u_cam_rot_z)));

                p = dot(v,p)*v + cross(v,p);

                if (u_is_tiling_enabled > 0.5) {
                    p = mod(p, u_tiling) - 0.5 * u_tiling;
                }
                
                vec3 v_abs = abs(p);
                float v_max_yz = max(v_abs.y, v_abs.z);
                v = max(v_abs, v_max_yz);

                vec3 v_de = abs(p) + sin(p / (v.x + 1e-5) * u_sin_freq + t + t);
                
                float dist_box = length(min(v_de, v_de.yzx) - 1.0);
                float dist_sphere = length(v_de) - 1.5;
                float shape_dist = mix(dist_box, dist_sphere, u_shape_morph);

                d = u_d_factor1 * abs(v.x - u_d_factor2) + u_d_factor3 * shape_dist;
                
                if (z > 0.0) {
                    o.rgb += v / max(d * z, 1e-6);
                }
                
                z += d;
            }

            vec3 mapped_color = o.rgb / u_exposure;
            mapped_color = mapped_color / (mapped_color + 1.0);
            
            gl_FragColor = vec4(mapped_color, 1.0);
        }
    </script>

    <!-- 
      PERFORMANCE NOTE:
      The main application script is placed at the end of the body and marked with 'defer'.
      'defer' ensures the script is downloaded in parallel with page parsing and executed only after
      the HTML document has been fully parsed, preventing it from blocking the page render.
      This is the optimal loading strategy for this script as it depends on DOM elements being available.
      The JavaScript code itself has NOT been modified.
    -->
    <script id="main-app-script" defer>
        // --- Main Application Logic ---
        const canvas = document.getElementById('gl-canvas');
        const menuToggle = document.getElementById('menu-toggle');
        const menuIconOpen = document.getElementById('menu-icon-open');
        const menuIconClose = document.getElementById('menu-icon-close');
        const settingsPanel = document.getElementById('settings-panel');
        const resetButton = document.getElementById('reset-button');
        
        const gl = canvas.getContext('webgl', { antialias: true });
        if (!gl) {
            const msg = 'WebGL is not supported by your browser. This application cannot run.';
            document.body.innerHTML = `<div style="color: white; text-align: center; padding-top: 50px; font-size: 1.2em;">${msg}</div>`;
            throw new Error(msg);
        }

        let shaderProgram;
        const uniformLocations = {};

        const sliderConfigs = {
            cameraDist: { id: 'camera-dist', valueId: 'camera-dist-value', isFloat: true, decimals: 1 },
            iterations: { id: 'iterations', valueId: 'iterations-value', isFloat: false },
            timeSpeed: { id: 'time-speed', valueId: 'time-speed-value', isFloat: true, decimals: 2 },
            exposure: { id: 'exposure', valueId: 'exposure-value', isFloat: false },
            deFactor1: { id: 'de-factor1', valueId: 'de-factor1-value', isFloat: true, decimals: 2 },
            deFactor2: { id: 'de-factor2', valueId: 'de-factor2-value', isFloat: true, decimals: 2 },
            deFactor3: { id: 'de-factor3', valueId: 'de-factor3-value', isFloat: true, decimals: 3 },
            sinFreq: { id: 'sin-freq', valueId: 'sin-freq-value', isFloat: true, decimals: 1 },
            camRotY: { id: 'cam-rot-y', valueId: 'cam-rot-y-value', isFloat: true, decimals: 1 },
            camRotZ: { id: 'cam-rot-z', valueId: 'cam-rot-z-value', isFloat: true, decimals: 1 },
            shapeMorph: { id: 'shape-morph', valueId: 'shape-morph-value', isFloat: true, decimals: 2 },
            tiling: { id: 'tiling', valueId: 'tiling-value', isFloat: true, decimals: 1 },
        };
        
        const defaultSettings = {
            cameraDist: 5.0,
            iterations: 50,
            timeSpeed: 0.5,
            exposure: 200,
            deFactor1: 0.2,
            deFactor2: 2.0,
            deFactor3: 0.1,
            sinFreq: 6.0,
            camRotY: 2.0,
            camRotZ: 4.0,
            shapeMorph: 0.0,
            isTilingEnabled: true,
            tiling: 10.0,
        };

        let settings = { ...defaultSettings };

        // --- UI and Settings Logic ---
        menuToggle.addEventListener('click', () => {
            const isOpening = settingsPanel.classList.toggle('translate-x-full');
            menuIconOpen.classList.toggle('hidden');
            menuIconClose.classList.toggle('hidden');
            menuToggle.classList.toggle('menu-open-pos');
            // Accessibility: Update aria-expanded state.
            menuToggle.setAttribute('aria-expanded', menuIconClose.classList.contains('hidden'));
        });

        resetButton.addEventListener('click', () => {
            settings = { ...defaultSettings };
            updateAllSlidersUI();
        });
        
        function setupSlider(key, config) {
            const slider = document.getElementById(config.id);
            slider.addEventListener('input', () => {
                const value = parseFloat(slider.value);
                settings[key] = value;
                updateValueDisplay(key);
            });
        }

        function updateValueDisplay(key) {
            const config = sliderConfigs[key];
            const valueDisplay = document.getElementById(config.valueId);
            const value = settings[key];
            valueDisplay.textContent = config.isFloat ? value.toFixed(config.decimals || 2) : String(value);
        }
        
        function setupTilingToggle() {
            const toggle = document.getElementById('tiling-toggle');
            const tilingSlider = document.getElementById('tiling');
            const tilingLabel = document.getElementById('tiling-label');
            const tilingValue = document.getElementById('tiling-value');

            toggle.addEventListener('change', () => {
                settings.isTilingEnabled = toggle.checked;
                updateTilingControlsState();
            });

            function updateTilingControlsState() {
                const isDisabled = !settings.isTilingEnabled;
                tilingSlider.disabled = isDisabled;
                [tilingSlider, tilingLabel, tilingValue].forEach(el => {
                    el.classList.toggle('opacity-50', isDisabled);
                    el.classList.toggle('pointer-events-none', isDisabled);
                });
            }
            return updateTilingControlsState;
        }

        function updateAllSlidersUI() {
            for (const key in sliderConfigs) {
                const config = sliderConfigs[key];
                const slider = document.getElementById(config.id);
                slider.value = settings[key];
                updateValueDisplay(key);
            }
            document.getElementById('tiling-toggle').checked = settings.isTilingEnabled;
            window.updateTilingControlsState();
        }

        // --- WebGL Initialization ---
        function initWebGL() {
            const vertexShader = createShader(gl, gl.VERTEX_SHADER, document.getElementById('vertex-shader').textContent);
            const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, document.getElementById('fragment-shader').textContent);

            shaderProgram = createProgram(gl, vertexShader, fragmentShader);
            if (!shaderProgram) return;

            uniformLocations.cameraDist = gl.getUniformLocation(shaderProgram, 'u_camera_dist');
            uniformLocations.iterations = gl.getUniformLocation(shaderProgram, 'u_iterations');
            uniformLocations.timeSpeed = gl.getUniformLocation(shaderProgram, 'u_time_mult');
            uniformLocations.exposure = gl.getUniformLocation(shaderProgram, 'u_exposure');
            uniformLocations.deFactor1 = gl.getUniformLocation(shaderProgram, 'u_d_factor1');
            uniformLocations.deFactor2 = gl.getUniformLocation(shaderProgram, 'u_d_factor2');
            uniformLocations.deFactor3 = gl.getUniformLocation(shaderProgram, 'u_d_factor3');
            uniformLocations.sinFreq = gl.getUniformLocation(shaderProgram, 'u_sin_freq');
            uniformLocations.camRotY = gl.getUniformLocation(shaderProgram, 'u_cam_rot_y');
            uniformLocations.camRotZ = gl.getUniformLocation(shaderProgram, 'u_cam_rot_z');
            uniformLocations.shapeMorph = gl.getUniformLocation(shaderProgram, 'u_shape_morph');
            uniformLocations.tiling = gl.getUniformLocation(shaderProgram, 'u_tiling');
            uniformLocations.isTilingEnabled = gl.getUniformLocation(shaderProgram, 'u_is_tiling_enabled');
            uniformLocations.resolution = gl.getUniformLocation(shaderProgram, 'u_resolution');
            uniformLocations.time = gl.getUniformLocation(shaderProgram, 'u_time');
            
            const positionBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, -1, 1, -1, -1, 1, -1, 1, 1, -1, 1, 1]), gl.STATIC_DRAW);
            
            const positionAttributeLocation = gl.getAttribLocation(shaderProgram, 'a_position');
            gl.enableVertexAttribArray(positionAttributeLocation);
            gl.vertexAttribPointer(positionAttributeLocation, 2, gl.FLOAT, false, 0, 0);

            for (const key in sliderConfigs) {
                setupSlider(key, sliderConfigs[key]);
            }
            window.updateTilingControlsState = setupTilingToggle();
            updateAllSlidersUI();
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            requestAnimationFrame(render);
        }

        // --- WebGL Helper Functions ---
        function createShader(gl, type, source) {
            const shader = gl.createShader(type);
            gl.shaderSource(shader, source);
            gl.compileShader(shader);
            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                console.error(`An error occurred compiling the ${type === gl.VERTEX_SHADER ? "vertex" : "fragment"} shader: ` + gl.getShaderInfoLog(shader));
                gl.deleteShader(shader);
                return null;
            }
            return shader;
        }

        function createProgram(gl, vertexShader, fragmentShader) {
            if (!vertexShader || !fragmentShader) return null;
            const program = gl.createProgram();
            gl.attachShader(program, vertexShader);
            gl.attachShader(program, fragmentShader);
            gl.linkProgram(program);
            if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
                console.error('Unable to initialize the shader program: ' + gl.getProgramInfoLog(program));
                return null;
            }
            return program;
        }
        
        // --- Render Loop ---
        function render(time) {
            time *= 0.001; // convert time to seconds

            gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);
            gl.clear(gl.COLOR_BUFFER_BIT);

            gl.useProgram(shaderProgram);

            gl.uniform2f(uniformLocations.resolution, gl.canvas.width, gl.canvas.height);
            gl.uniform1f(uniformLocations.time, time);
            for (const key in settings) {
                if(uniformLocations[key]) {
                    gl.uniform1f(uniformLocations[key], settings[key]);
                }
            }
            gl.uniform1f(uniformLocations.isTilingEnabled, settings.isTilingEnabled ? 1.0 : 0.0);


            gl.drawArrays(gl.TRIANGLES, 0, 6);

            requestAnimationFrame(render);
        }
        
        // --- Canvas Resizing ---
        function resizeCanvas() {
            const dpr = window.devicePixelRatio || 1;
            canvas.width = window.innerWidth * dpr;
            canvas.height = window.innerHeight * dpr;
            canvas.style.width = `${window.innerWidth}px`;
            canvas.style.height = `${window.innerHeight}px`;
            if (gl) {
               gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);
            }
        }

        // --- Start Application ---
        initWebGL();

    </script>
</body>
</html>
